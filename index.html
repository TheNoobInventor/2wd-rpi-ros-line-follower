
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://thenoobinventor.github.io/2wd-rpi-ros-line-follower/index.html">
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2-wheeled-drive-raspberry-pi-line-follower-running-ros1-noetic" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic" class="md-header__button md-logo" aria-label="2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/TheNoobInventor/2wd-rpi-ros-line-follower" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TheNoobInventor/2wd-rpi-ros-line-follower
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link md-tabs__link--active">
      2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic" class="md-nav__button md-logo" aria-label="2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/TheNoobInventor/2wd-rpi-ros-line-follower" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    TheNoobInventor/2wd-rpi-ros-line-follower
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="index.html" class="md-nav__link md-nav__link--active">
        2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware" class="md-nav__link">
    Hardware
  </a>
  
    <nav class="md-nav" aria-label="Hardware">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#components" class="md-nav__link">
    Components
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assembly" class="md-nav__link">
    Assembly
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#software" class="md-nav__link">
    Software
  </a>
  
    <nav class="md-nav" aria-label="Software">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#software-architecture" class="md-nav__link">
    Software architecture
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#package-install-and-setup" class="md-nav__link">
    Package install and setup
  </a>
  
    <nav class="md-nav" aria-label="Package install and setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#build-package" class="md-nav__link">
    Build package
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#custom-message" class="md-nav__link">
    Custom message
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-package-nodes" class="md-nav__link">
    Run package nodes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#race-tracks" class="md-nav__link">
    Race tracks
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rqt-graph" class="md-nav__link">
    Rqt graph
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#video-demonstration" class="md-nav__link">
    Video demonstration
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#future-work" class="md-nav__link">
    Future work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="2-wheeled-drive-raspberry-pi-line-follower-running-ros1-noetic">2 Wheeled Drive Raspberry Pi Line Follower running ROS1 Noetic</h1>
<p>A 2-wheel drive car, controlled by a Raspberry Pi 4 running Robot Operating System (ROS) 1 Noetic, is used as a line following robot; it follows a black line against a white background, with the aid of a 5 channel infrared sensor.</p>
<h2 id="hardware">Hardware</h2>
<h3 id="components">Components</h3>
<p>The components used in this project are as follows:</p>
<ul>
<li>2 wheeled drive robot chassis</li>
<li>Raspberry Pi 4</li>
<li>Monitor, keyboard and mouse for initial setup</li>
<li>Motor driver HAT (Waveshare)</li>
<li>2 x standoff spacers</li>
<li>5-channel infrared sensor (Waveshare)</li>
<li>9V battery</li>
<li>2 x alligator clip cables </li>
<li>Powerbank rated at least 5V and 3A with USB type-A to USB-type C cable to power RPi</li>
<li>Wires - to connect motors to motor driver HAT</li>
<li>Track(s) for robot to follow</li>
<li>Screwdriver set</li>
<li>Double-sided tape</li>
<li>Duck tape</li>
</ul>
<p>The 5-channel infrared sensor from Waveshare is shown in the figures below:</p>
<p align="center">
  <img src=images/ir_front.jpg width="400">
  <img src=images/ir_back.jpg width="400">
</p>

<p>The front, back and side views of the Motor driver HAT are as shown:</p>
<p align="center">
  <img src=images/motord_front.jpg width="400">
  <img src=images/motord_back.jpg width="400">
  <img src=images/motord_side.jpg width="400">
</p>

<h3 id="assembly">Assembly</h3>
<p>The 2 wheeled robot chassis is assembled using the guide shown <a href="https://www.ardu.dk/wp-content/uploads/2019/11/ARDU-2WD-robot-car-instructions.pdf">here</a>. The motor driver HAT is firmly attached to the GPIO pins on the Raspberry Pi with standoff spacers for added stability. The 5 channel infrared sensor is mounted underneath the robot chassis and connected to the RPi GPIO pins via the motor driver HAT in this order:</p>
<table>
<thead>
<tr>
<th>Infrared sensor</th>
<th>Cable color</th>
<th>GPIO.BOARD</th>
<th>GPIO.BCM</th>
</tr>
</thead>
<tbody>
<tr>
<td>IR1</td>
<td>Blue</td>
<td>19</td>
<td>GPIO16</td>
</tr>
<tr>
<td>IR2</td>
<td>Yellow</td>
<td>21</td>
<td>GPIO17</td>
</tr>
<tr>
<td>IR3</td>
<td>Orange</td>
<td>23</td>
<td>GPIO18</td>
</tr>
<tr>
<td>IR4</td>
<td>Green</td>
<td>22</td>
<td>GPIO13</td>
</tr>
<tr>
<td>IR5</td>
<td>White</td>
<td>24</td>
<td>GPIO19</td>
</tr>
</tbody>
</table>
<p>The red and black cables are connected to a 5V and ground (GND) GPIO pins respectively.</p>
<p>The RPi was placed on a 3D printed platform using double-sided tape, which was mounted to the chassis also with double-sided tape. </p>
<p>One end of the cables from the motors were soldered with the other end connected to the motor driver HAT. The motor driver HAT is powered using the 9V battery via the alligator cables. </p>
<p>Finally, the raspberry pi is powered by the power bank, via a USB type-A to USB type-C cable, which is mounted on the chassis with double-sided tape.</p>
<p>The fully assembled robot is shown in the following images:</p>
<p align="center">
  <img src=images/side.jpg width="400">
  <img src=images/top.jpg width="400">
  <img src=images/bottom.jpg width="400">
</p>

<h2 id="software">Software</h2>
<h3 id="software-architecture">Software architecture</h3>
<p><strong>Raspberry Pi OS</strong> is the operating system used on the Raspberry Pi 4. The download and installation procedure can be found <a href="https://www.raspberrypi.org/software/">here</a>. ROS 1 Noetic is the version of ROS used in this project and can be installed following this <a href="https://www.hackster.io/shahizat005/lidar-integration-with-ros-noetic-on-raspberry-pi-os-8ea140">guide</a>.</p>
<p>For ease of access, debugging and mobility, the Raspberry Pi (and further robot operations) is setup in a headless or remote mode using the <a href="https://www.raspberrypi.org/documentation/computers/remote-access.html#vnc">VNC Viewer</a> or <a href="https://www.raspberrypi.org/documentation/computers/remote-access.html#ssh">ssh</a> for more advanced users.</p>
<h3 id="package-install-and-setup">Package install and setup</h3>
<p>Once Raspberry Pi OS and ROS Noetic have been successfully setup, the next step is to download and setup the ROS package in this repository. </p>
<p>Open up a terminal window and navigate to the source folder in your ROS workspace (<code>ros_catkin_ws/src</code> in my case) and clone this repository by executing the following command in the terminal:</p>
<pre><code>git clone https://github.com/TheNoobInventor/2wd-rpi-ros-line-follower.git
</code></pre>
<p>The motor driver HAT uses Inter-Integrated Circuit (I2C) serial interface to communicate with the Raspberry Pi. This interface needs to be enabled in Raspberry Pi OS, which is disabled by default. To do this, click on the <strong><em>RPi Home</em></strong> button, navigate to <strong><em>Preferences</em></strong>, then <strong><em>Raspberry Pi Configuration</em></strong> to <strong><em>I2C</em></strong> and finally click on the <strong><em>Enable</em></strong> radio button. Then reboot the RPi for this change to be effected.</p>
<h4 id="build-package">Build package</h4>
<hr />
<p>To build the package, move up one level to the main ROS workspace (<code>ros_catkin_ws</code>) and run the following command in the terminal:</p>
<pre><code>catkin_make
</code></pre>
<h4 id="custom-message">Custom message</h4>
<hr />
<p>A custom message - <code>IrSensor.msg</code> in the <code>msg</code> folder -  of type int32, was created to store data outputted from the different channels of the infrared sensor.</p>
<h4 id="run-package-nodes">Run package nodes</h4>
<hr />
<p>There are two ROS nodes -- written in <strong>Python3</strong> -- in this package in the <code>src</code> directory:</p>
<p><code>ir_sensor_node.py</code> - this publishes data about the values 
returned by the 5 channel infrared sensor, through the topic 'infra_readings' </p>
<p><code>rpi_car_main_node.py</code> - this node subscribes to the infrared sensor data in the 'infra_readings' topic and uses this data to control the robot to move around the track(s).</p>
<p>Before running these nodes, the following python packages will need to be installed - if they are not already installed:</p>
<p><code>rospkg</code> - this provides basic utilities for querying information about ROS packages and stacks.</p>
<p><code>smbus</code> - this package is required by the PCA9685 PWM controller in order to use the i2c serial interface.</p>
<p>Open up a new terminal window and run the following command:</p>
<pre><code>pip3 install rospkg &amp;&amp; pip3 install smbus
</code></pre>
<p>In addition to the node files previously introduced, these two files are needed in this package:</p>
<p><code>PCA9685.py</code> - this is a low-level driver script to use the PCA9865 PWM controller employed by the motor driver HAT to control the motors.</p>
<p><code>motor.py</code>- this is a motor class which uses the PCA9685 PWM controller to control the speeds of the motors connected to the motor driver HAT.</p>
<p>In order to run the nodes, the files first need to be made executable. This can be achieved by running this command in a terminal window:</p>
<pre><code>chmod +x ir_sensor_node.py rpi_car_main_node.py
</code></pre>
<p>Both nodes can be started up at once by using the launch file <code>rpi_car.launch</code> in the <code>src/launch</code> directory. Execute the following commad:</p>
<pre><code>roslaunch rpi_car_line_follower rpi_car.launch
</code></pre>
<p>For debugging purposes, the infrared sensor data can be viewed by echoing the data from the 'infra_readings' topic in a separate terminal window:</p>
<pre><code>rostopic echo /infra_readings
</code></pre>
<h2 id="race-tracks">Race tracks</h2>
<p>The following race tracks are used to test out the ROS package:</p>
<p float="left">
  <img src=images/round_track.jpg width="400">
</p>
<p float="right">
  <img src=images/fig_8.jpg width="400">
</p>

<p>With the robot placed on the black line of the track, the launch file is executed. The main node, <code>rpi_car_main_node.py</code>, attempts to keep the robot on the black line whilst moving around the track. It uses data from the infrared sensors - which return 0 if they are over a black line or 1 if they are over the white part of the track. These numbers are used in varying the speeds of the motor to get the robot to follow the line. This process is shown in the following code block from the main node:</p>
<pre><code>if (ir_1 == 1 and ir_2 == 1 and ir_3 == 0 and ir_4 == 1 and ir_5 == 1):
    # Move robot forward
    Motor.MotorRun(0, 'forward', 70)
    Motor.MotorRun(1, 'forward', 70)
elif (ir_1 == 1 and ir_2 == 0 and ir_3 == 0 and ir_4 == 1 and ir_5 == 1):
    # Move robot slightly left
    Motor.MotorRun(0, 'forward', 65)
    Motor.MotorRun(1, 'forward', 70)
  ...
</code></pre>
<p>The motor speeds were obtained iteratively through trial and error.</p>
<p>It was observed that the initial black lines of the race tracks were too thin and caused issues with the infrared sensors accurately returning values. Duck tape was used to widen the track to enable each infrared sensor to read the black line correctly.</p>
<p>The figure below visualizes the robot movememnts to be made based on the location of the infrared sensors in relation to the black line of the race track. </p>
<p align="center"><img src=images/sensor_map.png> </p>

<h2 id="rqt-graph">Rqt graph</h2>
<p>The nodes and topics relations can be viewed by making use of the ROS tool: <strong><em>rqt</em></strong>. Run rqt by executing this command in the terminal:</p>
<pre><code>rqt
</code></pre>
<p>In the Graphical User Interface (GUI) that opens up, click on check-button on the 'infra_readings' topic. Afterward, navigate to <strong><em>Plugins</em></strong> in the menu then to <strong><em>Introspection</em></strong> and click on <strong><em>Node graph</em></strong>. This will output a window with the following image showing the relationship between the nodes and the 'infra_readings' topic:</p>
<p align="center"><img src=images/rosgraph.png> </p>

<h2 id="video-demonstration">Video demonstration</h2>
<p>The following video (clicking the image below) walks through the setup procedure for this project and shows the robot moving around both tracks whilst following the black line.</p>
<p><a href="https://youtu.be/u9ZQiseMk1M"><img src="images/side.jpg" width="50%"></a></p>
<h2 id="future-work">Future work</h2>
<p>Some suggestions for upgrades include:</p>
<ul>
<li>
<p>Moving project over to ROS2.</p>
</li>
<li>
<p>Employing a better power solution using a set of 18650 batteries instead of the 9V battery.</p>
</li>
<li>
<p>Adding more sensors to increase the complexity.</p>
</li>
</ul>
<h2 id="references">References</h2>
<ul>
<li>
<p><a href="https://www.waveshare.com/wiki/Motor_Driver_HAT">Motor Driver HAT</a></p>
</li>
<li>
<p><a href="https://www.waveshare.com/wiki/Tracker_Sensor">Infrared Sensor</a></p>
</li>
<li>
<p><a href="https://rospkg.readthedocs.io/en/latest/">Rospkg</a></p>
</li>
<li>
<p><a href="https://pypi.org/project/smbus2/">smbus package</a></p>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.top", "toc.integrate"], "search": "assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.8492ddcf.min.js"></script>
      
    
  </body>
</html>